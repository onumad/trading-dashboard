<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Accounts Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0a0e27',
                        'card-bg': '#1a1f3a',
                        'card-border': '#2a2f4a',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles if needed */
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-purple-900 min-h-screen text-gray-200 p-5">
    <div class="max-w-7xl mx-auto">
        <!-- View Toggle -->
        <div class="flex gap-3 justify-center mb-8">
            <button onclick="setView('grid')" id="gridViewBtn" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition-all border-2 border-indigo-400">
                üî≤ Grid View
            </button>
            <button onclick="setView('list')" id="listViewBtn" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-all border-2 border-transparent">
                üìã List View
            </button>
        </div>

        <!-- Calendar -->
        <div class="text-center mb-8">
            <div class="inline-block bg-slate-800 p-6 rounded-xl border-2 border-indigo-500 shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="changeMonth(-1)" class="px-4 py-2 bg-slate-700 hover:bg-indigo-600 rounded-lg transition-all">‚óÄ</button>
                    <div id="calendarMonth" class="text-xl font-bold">January 2026</div>
                    <button onclick="changeMonth(1)" class="px-4 py-2 bg-slate-700 hover:bg-indigo-600 rounded-lg transition-all">‚ñ∂</button>
                </div>
                <div class="grid grid-cols-7 gap-2 mb-2">
                    <div class="text-xs text-gray-400 text-center p-1">Sun</div>
                    <div class="text-xs text-gray-400 text-center p-1">Mon</div>
                    <div class="text-xs text-gray-400 text-center p-1">Tue</div>
                    <div class="text-xs text-gray-400 text-center p-1">Wed</div>
                    <div class="text-xs text-gray-400 text-center p-1">Thu</div>
                    <div class="text-xs text-gray-400 text-center p-1">Fri</div>
                    <div class="text-xs text-gray-400 text-center p-1">Sat</div>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
            </div>
        </div>

        <!-- Accounts Container -->
        <div id="accountsContainer" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">
            <div class="text-center text-gray-400 p-12">Loading...</div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentMonth = 0;
        let selectedDate = '2026-01-29';
        const tradingDays = ['2026-01-29'];
        const tradingData = {
            '2026-01-29': { pnl: 3494.90, dayNumber: 1 }
        };
        let currentView = localStorage.getItem('dashboardView') || 'grid';
        
        // Account goals with defaults
        const defaultGoals = {
            'lucid': 1000,
            'apex': 2600
        };
        
        function getAccountGoals() {
            const saved = localStorage.getItem('accountGoals');
            return saved ? JSON.parse(saved) : {};
        }
        
        function setAccountGoal(accountId, goal) {
            const goals = getAccountGoals();
            goals[accountId] = parseFloat(goal);
            localStorage.setItem('accountGoals', JSON.stringify(goals));
        }
        
        function getGoalForAccount(accountId, type) {
            const goals = getAccountGoals();
            return goals[accountId] || defaultGoals[type] || 1000;
        }

        function setView(view) {
            currentView = view;
            localStorage.setItem('dashboardView', view);
            
            const gridBtn = document.getElementById('gridViewBtn');
            const listBtn = document.getElementById('listViewBtn');
            
            if (view === 'grid') {
                gridBtn.className = 'px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition-all border-2 border-indigo-400';
                listBtn.className = 'px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-all border-2 border-transparent';
            } else {
                gridBtn.className = 'px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-all border-2 border-transparent';
                listBtn.className = 'px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition-all border-2 border-indigo-400';
            }
            
            if (currentData) {
                renderDashboard();
            }
        }

        function renderCalendar() {
            const year = 2026;
            const month = currentMonth;
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDayOfWeek = firstDay.getDay();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'w-20 h-20';
                grid.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayEl = document.createElement('div');
                const dayData = tradingData[dateStr];
                
                if (!tradingDays.includes(dateStr)) {
                    dayEl.className = 'w-20 h-20 flex flex-col items-center justify-center bg-slate-700 rounded-lg opacity-30 cursor-not-allowed p-2';
                    dayEl.innerHTML = `<div class="text-sm">${day}</div>`;
                } else {
                    dayEl.className = dateStr === selectedDate 
                        ? 'w-20 h-20 flex flex-col items-center justify-center bg-indigo-600 rounded-lg cursor-pointer hover:scale-105 transition-all font-bold p-2'
                        : 'w-20 h-20 flex flex-col items-center justify-center bg-slate-700 rounded-lg cursor-pointer hover:bg-indigo-600 hover:scale-105 transition-all p-2';
                    
                    const pnlClass = dayData.pnl >= 0 ? 'text-green-400' : 'text-red-400';
                    dayEl.innerHTML = `
                        <div class="text-sm mb-1">${day}</div>
                        <div class="text-xs ${pnlClass} font-semibold">${dayData.pnl >= 0 ? '+' : ''}$${dayData.pnl.toFixed(0)}</div>
                    `;
                    dayEl.onclick = () => selectDate(dateStr);
                }
                
                grid.appendChild(dayEl);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) currentMonth = 11;
            if (currentMonth > 11) currentMonth = 0;
            renderCalendar();
        }

        function selectDate(date) {
            selectedDate = date;
            renderCalendar();
            loadDate(date);
        }

        async function loadDate(date) {
            try {
                const response = await fetch(`data/${date}.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load data for ${date}`);
                }
                
                currentData = await response.json();
                
                // Store the data for calendar display
                if (!tradingData[date]) {
                    tradingData[date] = {
                        pnl: currentData.totalPnl,
                        dayNumber: currentData.dayNumber
                    };
                }
                
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('accountsContainer').innerHTML = 
                    '<div class="col-span-full text-center text-red-400 p-12">‚ùå Failed to load data for ' + date + '</div>';
            }
        }

        function renderDashboard() {
            if (!currentData) return;

            const container = document.getElementById('accountsContainer');
            container.innerHTML = '';
            
            if (currentView === 'grid') {
                container.className = 'grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10';
            } else {
                container.className = 'flex flex-col gap-4 mb-10';
            }

            container.appendChild(createLucidCard(currentData.accounts.lucid));

            currentData.accounts.apex.forEach(account => {
                container.appendChild(createApexCard(account));
            });
        }

        function createLucidCard(data) {
            const card = document.createElement('div');
            const customGoal = getGoalForAccount(data.id, 'lucid');
            const profitProgress = (data.pnl / customGoal * 100).toFixed(1);
            
            if (currentView === 'list') {
                card.className = 'bg-slate-800 rounded-xl p-6 border-l-4 border-amber-500 hover:translate-y-[-4px] transition-all shadow-lg grid grid-cols-4 items-center gap-6';
                card.innerHTML = `
                    <div>
                        <div class="flex items-center gap-3 mb-1">
                            <div class="w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center text-white font-bold text-xs">L</div>
                            <span class="font-bold text-lg">Lucid Flex 50k</span>
                        </div>
                        <div class="text-sm text-gray-400 font-mono">${data.id}</div>
                    </div>
                    <div class="text-3xl font-bold ${data.pnl >= 0 ? 'text-green-400' : 'text-red-400'}">
                        $${data.pnl.toFixed(2)}
                    </div>
                    <div class="flex gap-6">
                        <div>
                            <div class="text-xs text-gray-400">Days</div>
                            <div class="text-lg font-semibold">${currentData.dayNumber}</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Trades</div>
                            <div class="text-lg font-semibold">${data.trades.length}</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Progress</div>
                            <div class="text-lg font-semibold">${profitProgress}%</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Goal</div>
                            <div class="text-lg font-semibold">$${customGoal.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">Profitable Days</div>
                        <div class="text-lg font-semibold">${data.profitableDays150} / 5</div>
                    </div>
                `;
                return card;
            }
            
            card.className = 'bg-slate-800 rounded-xl p-6 border-l-4 border-amber-500 hover:translate-y-[-4px] transition-all shadow-lg';
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <div class="w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center text-white font-bold text-xs">L</div>
                            <span class="text-xl font-bold">Lucid Flex 50k</span>
                        </div>
                        <div class="text-sm text-gray-400 font-mono">${data.id}</div>
                    </div>
                </div>
                
                <div class="text-4xl font-bold ${data.pnl >= 0 ? 'text-green-400' : 'text-red-400'} my-4">
                    $${data.pnl.toFixed(2)}
                </div>
                
                <div class="flex justify-between py-3 border-b border-slate-700">
                    <span class="text-gray-400">Days Traded</span>
                    <span class="font-semibold">${currentData.dayNumber}</span>
                </div>
                
                <div class="flex justify-between py-3 border-b border-slate-700">
                    <span class="text-gray-400">Closed Trades</span>
                    <span class="font-semibold">${data.trades.length}</span>
                </div>
                
                <div class="mt-5 p-4 bg-slate-900 rounded-lg border-l-4 border-green-500">
                    <h4 class="text-sm font-semibold mb-3 text-green-400">üìä Payout Progress</h4>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">
                            Profit Goal: $${data.pnl.toFixed(0)} / 
                            <span id="goal-${data.id}">$${customGoal.toLocaleString()}</span>
                            <button onclick="editGoal('${data.id}', 'lucid', ${customGoal})" class="ml-2 text-xs text-indigo-400 hover:text-indigo-300">‚úèÔ∏è</button>
                        </span>
                        <span class="text-xs">${profitProgress >= 100 ? '‚úÖ' : '‚è≥'}</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${Math.min(profitProgress, 100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Profitable Days ($150+): ${data.profitableDays150} / 5</span>
                        <span class="text-xs">‚è≥</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${(data.profitableDays150 / 5 * 100).toFixed(1)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Safety Buffer: $${data.pnl.toFixed(0)} above start</span>
                        <span class="text-xs">üí∞</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: 100%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">Max Payout: $2,000 (50% of profit)</span>
                        <span class="text-xs">üí°</span>
                    </div>
                </div>
                
                <div class="mt-5 pt-5 border-t-2 border-slate-700">
                    <h4 class="text-sm text-gray-400 mb-3">Recent Trades</h4>
                    ${data.trades.map(trade => `
                        <div class="flex justify-between items-center p-2 mb-2 bg-slate-900 rounded-lg text-sm">
                            <span>${trade.type} ${trade.desc}: ${trade.pnl >= 0 ? '+' : '-'}$${Math.abs(trade.pnl).toFixed(0)}</span>
                            <span class="text-lg">${trade.pnl >= 0 ? '‚úÖ' : '‚ùå'}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return card;
        }

        function createApexCard(data) {
            const card = document.createElement('div');
            const customGoal = getGoalForAccount(data.id, 'apex');
            const tradingDaysProgress = (data.tradingDays / 8 * 100).toFixed(1);
            const profitDaysProgress = (data.profitableDays50 / 5 * 100).toFixed(1);
            const profitGoalProgress = (data.pnl / customGoal * 100).toFixed(1);
            const balanceProgress = (data.balance / data.minBalanceGoal * 100).toFixed(1);
            const bufferProgress = (data.safetyBuffer / data.safetyBufferGoal * 100).toFixed(1);
            
            if (currentView === 'list') {
                card.className = 'bg-slate-800 rounded-xl p-6 border-l-4 border-purple-500 hover:translate-y-[-4px] transition-all shadow-lg grid grid-cols-4 items-center gap-6';
                card.innerHTML = `
                    <div>
                        <div class="flex items-center gap-3 mb-1">
                            <div class="w-8 h-8 bg-gradient-to-br from-purple-600 to-indigo-700 rounded-lg flex items-center justify-center text-white font-bold text-xs">A</div>
                            <span class="font-bold text-lg">Apex 50k #${data.num}</span>
                        </div>
                        <div class="text-sm text-gray-400 font-mono">${data.id}</div>
                    </div>
                    <div class="text-3xl font-bold ${data.pnl >= 0 ? 'text-green-400' : 'text-red-400'}">
                        $${data.pnl.toFixed(2)}
                    </div>
                    <div class="flex gap-6">
                        <div>
                            <div class="text-xs text-gray-400">Days</div>
                            <div class="text-lg font-semibold">${data.tradingDays}</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Trades</div>
                            <div class="text-lg font-semibold">${data.trades.length}</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Progress</div>
                            <div class="text-lg font-semibold">${Math.min(profitGoalProgress, 100).toFixed(0)}%</div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-400">Goal</div>
                            <div class="text-lg font-semibold">$${customGoal.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-xs text-gray-400">Profitable Days</div>
                        <div class="text-lg font-semibold">${data.profitableDays50} / 5</div>
                    </div>
                `;
                return card;
            }
            
            card.className = 'bg-slate-800 rounded-xl p-6 border-l-4 border-purple-500 hover:translate-y-[-4px] transition-all shadow-lg';
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            <div class="w-8 h-8 bg-gradient-to-br from-purple-600 to-indigo-700 rounded-lg flex items-center justify-center text-white font-bold text-xs">A</div>
                            <span class="text-xl font-bold">Apex 50k #${data.num}</span>
                        </div>
                        <div class="text-sm text-gray-400 font-mono">${data.id}</div>
                    </div>
                </div>
                
                <div class="text-4xl font-bold ${data.pnl >= 0 ? 'text-green-400' : 'text-red-400'} my-4">
                    $${data.pnl.toFixed(2)}
                </div>
                
                <div class="flex justify-between py-3 border-b border-slate-700">
                    <span class="text-gray-400">Days Traded</span>
                    <span class="font-semibold">${data.tradingDays}</span>
                </div>
                
                <div class="flex justify-between py-3 border-b border-slate-700">
                    <span class="text-gray-400">Closed Trades</span>
                    <span class="font-semibold">${data.trades.length}</span>
                </div>
                
                <div class="mt-5 p-4 bg-slate-900 rounded-lg border-l-4 border-green-500">
                    <h4 class="text-sm font-semibold mb-3 text-green-400">üìä Payout Progress</h4>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">
                            Profit Goal: $${data.pnl.toFixed(0)} / 
                            <span id="goal-${data.id}">$${customGoal.toLocaleString()}</span>
                            <button onclick="editGoal('${data.id}', 'apex', ${customGoal})" class="ml-2 text-xs text-indigo-400 hover:text-indigo-300">‚úèÔ∏è</button>
                        </span>
                        <span class="text-xs">${profitGoalProgress >= 100 ? '‚úÖ' : '‚è≥'}</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${Math.min(profitGoalProgress, 100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Trading Days: ${data.tradingDays} / 8</span>
                        <span class="text-xs">‚è≥</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${tradingDaysProgress}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Profitable Days ($50+): ${data.profitableDays50} / 5</span>
                        <span class="text-xs">‚è≥</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${profitDaysProgress}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Safety Buffer: $${data.safetyBuffer.toFixed(0)} / $${data.safetyBufferGoal.toLocaleString()}</span>
                        <span class="text-xs">‚è≥</span>
                    </div>
                    <div class="w-full h-2 bg-slate-700 rounded-full overflow-hidden mb-4">
                        <div class="h-full bg-gradient-to-r from-green-500 to-cyan-400" style="width: ${Math.min(bufferProgress, 100)}%"></div>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-400">Max Payout (first 5): $2,000</span>
                        <span class="text-xs">üí°</span>
                    </div>
                </div>
                
                <div class="mt-5 pt-5 border-t-2 border-slate-700">
                    <h4 class="text-sm text-gray-400 mb-3">Recent Trades</h4>
                    ${data.trades.map(trade => `
                        <div class="flex justify-between items-center p-2 mb-2 bg-slate-900 rounded-lg text-sm">
                            <span>${trade.type} ${trade.desc}: ${trade.pnl >= 0 ? '+' : '-'}$${Math.abs(trade.pnl).toFixed(0)}</span>
                            <span class="text-lg">${trade.pnl >= 0 ? '‚úÖ' : '‚ùå'}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return card;
        }

        function editGoal(accountId, type, currentGoal) {
            const newGoal = prompt(`Set new profit goal for ${accountId}:`, currentGoal);
            if (newGoal !== null && !isNaN(newGoal) && parseFloat(newGoal) > 0) {
                setAccountGoal(accountId, newGoal);
                renderDashboard(); // Re-render to show new goal
            }
        }

        // Initialize
        setView(currentView);
        renderCalendar();
        loadDate('2026-01-29');
    </script>
</body>
</html>
